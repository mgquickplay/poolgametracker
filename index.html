<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Office Pool Tracker</title>

  <!-- Tailwind (utility CSS) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React 18 + ReactDOM UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel to allow JSX in-browser -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useMemo, useState, useEffect } = React;

    // ====== Small helpers ======
    const MAX_GAMES_DEFAULT = 20;
    const PREF_GAS_URL = "pool-pref-gas-url";
    const PREF_AUTO_LOAD = "pool-pref-auto-load";
    const PREF_AUTO_SAVE = "pool-pref-auto-save";

    const clsx = (...xs) => xs.filter(Boolean).join(" ");
    const strToUtf8 = (s) => new TextEncoder().encode(s);
    const utf8ToStr = (u8) => new TextDecoder().decode(u8);
    const bytesToBase64 = (bytes) => {
      let s = ""; bytes.forEach(b => s += String.fromCharCode(b)); return btoa(s);
    };
    const base64ToBytes = (b64) => {
      const bin = atob(b64); const out = new Uint8Array(bin.length);
      for (let i=0;i<bin.length;i++) out[i] = bin.charCodeAt(i);
      return out;
    };
    const base64url = (bytes) => bytesToBase64(bytes).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");
    async function sha256Base64Url(str) {
      const hash = await crypto.subtle.digest("SHA-256", strToUtf8(str));
      return base64url(new Uint8Array(hash));
    }

    // ====== Encrypt / Decrypt (AES-GCM + PBKDF2) ======
    async function encryptJSON(obj, passphrase) {
      const data = strToUtf8(JSON.stringify(obj));
      const salt = crypto.getRandomValues(new Uint8Array(16));
      const iv = crypto.getRandomValues(new Uint8Array(12));
      const keyMaterial = await crypto.subtle.importKey("raw", strToUtf8(passphrase), "PBKDF2", false, ["deriveKey"]);
      const key = await crypto.subtle.deriveKey(
        { name:"PBKDF2", salt, iterations:150000, hash:"SHA-256" },
        keyMaterial, { name:"AES-GCM", length:256 }, true, ["encrypt","decrypt"]
      );
      const ct = new Uint8Array(await crypto.subtle.encrypt({ name:"AES-GCM", iv }, key, data));
      return { v:1, algo:"AES-GCM", kdf:"PBKDF2-SHA256", iter:150000,
               salt: bytesToBase64(salt), iv: bytesToBase64(iv), ct: bytesToBase64(ct) };
    }
    async function decryptJSON(pkg, passphrase) {
      const salt = base64ToBytes(pkg.salt);
      const iv = base64ToBytes(pkg.iv);
      const ct = base64ToBytes(pkg.ct);
      const keyMaterial = await crypto.subtle.importKey("raw", strToUtf8(passphrase), "PBKDF2", false, ["deriveKey"]);
      const key = await crypto.subtle.deriveKey(
        { name:"PBKDF2", salt, iterations:pkg.iter||150000, hash:"SHA-256" },
        keyMaterial, { name:"AES-GCM", length:256 }, true, ["encrypt","decrypt"]
      );
      const pt = new Uint8Array(await crypto.subtle.decrypt({ name:"AES-GCM", iv }, key, ct));
      return JSON.parse(utf8ToStr(pt));
    }

    // ====== Apps Script fetch helpers ======
    // GET ?op=get&key=VAULT_HASH  -> returns encrypted JSON string
    // POST ?op=put&key=VAULT_HASH  body=text/plain (encrypted JSON) -> 200 OK
    async function driveLoad(gasUrl, key) {
      const res = await fetch(`${gasUrl}?op=get&key=${encodeURIComponent(key)}`);
      if (res.status === 404) return null;
      if (!res.ok) throw new Error(`Drive load HTTP ${res.status}`);
      const text = await res.text();
      return JSON.parse(text);
    }
    async function driveSave(gasUrl, key, encryptedJsonText) {
      const res = await fetch(`${gasUrl}?op=put&key=${encodeURIComponent(key)}`, {
        method: "POST",
        headers: { "Content-Type":"text/plain" },
        body: encryptedJsonText
      });
      if (!res.ok) throw new Error(`Drive save HTTP ${res.status}`);
      return true;
    }

    // ====== Lock shell ======
    function Shell() {
      const [phrase, setPhrase] = useState("");
      const [vaultKey, setVaultKey] = useState(null);

      async function unlock(e) {
        e.preventDefault();
        const hash = await sha256Base64Url(phrase || "");
        setVaultKey(`pool-vault:${hash}`);
      }

      if (!vaultKey) {
        return (
          <div className="min-h-screen flex items-center justify-center p-6">
            <form onSubmit={unlock} className="w-full max-w-sm bg-white rounded-2xl shadow p-6 space-y-4">
              <h1 className="text-xl font-semibold">Unlock Pool Tracker</h1>
              <p className="text-sm text-gray-600">Enter your unique phrase. Use the same phrase on any device.</p>
              <input
                type="password"
                className="w-full px-3 py-2 rounded-xl border bg-white shadow-sm focus:outline-none"
                placeholder="Your phrase"
                value={phrase}
                onChange={(e)=>setPhrase(e.target.value)}
                required
              />
              <button className="w-full px-4 py-2 rounded-2xl bg-black text-white shadow">Unlock</button>
            </form>
          </div>
        );
      }

      return <App passphrase={phrase} vaultKey={vaultKey} relock={()=>{ setVaultKey(null); setPhrase(""); }} />;
    }

    // ====== App ======
    function App({ passphrase, vaultKey, relock }) {
      // Preferences (not sensitive)
      const [gasUrl, setGasUrl] = useState(localStorage.getItem(PREF_GAS_URL) || "");
      const [autoLoad, setAutoLoad] = useState(JSON.parse(localStorage.getItem(PREF_AUTO_LOAD) ?? "true"));
      const [autoSave, setAutoSave] = useState(JSON.parse(localStorage.getItem(PREF_AUTO_SAVE) ?? "false"));
      useEffect(()=>localStorage.setItem(PREF_GAS_URL, gasUrl), [gasUrl]);
      useEffect(()=>localStorage.setItem(PREF_AUTO_LOAD, JSON.stringify(autoLoad)), [autoLoad]);
      useEffect(()=>localStorage.setItem(PREF_AUTO_SAVE, JSON.stringify(autoSave)), [autoSave]);

      // Compute vault hash for Drive key
      const [vaultHash, setVaultHash] = useState("(hashing…)");
      useEffect(()=>{ (async()=> setVaultHash(await sha256Base64Url(passphrase||"")))(); }, [passphrase]);

      // Decrypt local vault (if present), else defaults
      const loadLocalEncrypted = () => {
        try { const raw = localStorage.getItem(vaultKey); return raw ? JSON.parse(raw) : null; }
        catch { return null; }
      };

      const [initState, setInitState] = useState(null);
      const [ready, setReady] = useState(false);

      useEffect(()=>{
        (async()=>{
          try {
            const enc = loadLocalEncrypted();
            if (enc) {
              const dec = await decryptJSON(enc, passphrase);
              setInitState({
                opponents: (dec.opponents||[]).map(o => ({...o, photo:o.photo??null})) || [],
                maxGames: dec.maxGames ?? MAX_GAMES_DEFAULT,
                meName: dec.meName ?? "Me",
              });
            } else {
              setInitState({
                opponents: [{ id: crypto.randomUUID(), name:"Alice", games:Array(MAX_GAMES_DEFAULT).fill(null), photo:null }],
                maxGames: MAX_GAMES_DEFAULT,
                meName: "Me",
              });
            }
          } catch {
            alert("Unlock failed. Wrong phrase or corrupted data.");
            relock();
            return;
          } finally {
            setReady(true);
          }
        })();
      }, [vaultKey]);

      if (!ready || !initState) {
        return <div className="min-h-screen flex items-center justify-center text-gray-500">Loading…</div>;
      }

      return (
        <InnerApp
          initial={initState}
          passphrase={passphrase}
          vaultKey={vaultKey}
          gasUrl={gasUrl}
          setGasUrl={setGasUrl}
          autoLoad={autoLoad}
          setAutoLoad={setAutoLoad}
          autoSave={autoSave}
          setAutoSave={setAutoSave}
          vaultHash={vaultHash}
          relock={relock}
        />
      );
    }

    function InnerApp({ initial, passphrase, vaultKey, gasUrl, setGasUrl, autoLoad, setAutoLoad, autoSave, setAutoSave, vaultHash, relock }) {
      const [opponents, setOpponents] = useState(initial.opponents);
      const [maxGames, setMaxGames] = useState(initial.maxGames);
      const [meName, setMeName] = useState(initial.meName);
      const [view, setView] = useState("tracker"); // tracker | league | settings

      // Persist encrypted locally on any change
      useEffect(()=>{
        (async ()=>{
          const payload = { opponents, maxGames, meName, ts: Date.now() };
          const enc = await encryptJSON(payload, passphrase);
          localStorage.setItem(vaultKey, JSON.stringify(enc));
        })();
      }, [opponents, maxGames, meName, passphrase, vaultKey]);

      // ---- Auto-load from Drive after unlock ----
      useEffect(()=>{
        (async ()=>{
          if (!autoLoad || !gasUrl) return;
          try {
            const enc = await driveLoad(gasUrl, vaultHash);
            if (!enc) return; // nothing stored yet
            const data = await decryptJSON(enc, passphrase);
            setOpponents((data.opponents||[]).map(o=>({...o, photo:o.photo??null})));
            setMaxGames(data.maxGames ?? MAX_GAMES_DEFAULT);
            setMeName(data.meName ?? "Me");
          } catch (e) {
            console.warn("Auto-load failed:", e);
          }
        })();
        // run once on mount
        // eslint-disable-next-line react-hooks/exhaustive-deps
      }, []);

      // ---- Optional auto-save to Drive on changes ----
      useEffect(()=>{
        (async ()=>{
          if (!autoSave || !gasUrl) return;
          const payload = { opponents, maxGames, meName, ts: Date.now() };
          const enc = await encryptJSON(payload, passphrase);
          try {
            await driveSave(gasUrl, vaultHash, JSON.stringify(enc));
          } catch (e) {
            console.warn("Auto-save failed:", e);
          }
        })();
      }, [opponents, maxGames, meName, autoSave, gasUrl, passphrase, vaultHash]);

      // Manual cloud actions
      async function saveToDrive() {
        if (!gasUrl) { alert("Enter your Apps Script Web App URL in Settings."); return; }
        const payload = { opponents, maxGames, meName, ts: Date.now() };
        const enc = await encryptJSON(payload, passphrase);
        await driveSave(gasUrl, vaultHash, JSON.stringify(enc));
        alert("Saved to Drive.");
      }
      async function loadFromDrive() {
        if (!gasUrl) { alert("Enter your Apps Script Web App URL in Settings."); return; }
        const enc = await driveLoad(gasUrl, vaultHash);
        if (!enc) { alert("No data found for this phrase yet."); return; }
        const data = await decryptJSON(enc, passphrase);
        setOpponents((data.opponents||[]).map(o=>({...o, photo:o.photo??null})));
        setMaxGames(data.maxGames ?? MAX_GAMES_DEFAULT);
        setMeName(data.meName ?? "Me");
        alert("Loaded from Drive.");
      }

      // Actions
      const addOpponent = () => setOpponents(p => [...p, { id: crypto.randomUUID(), name:"New Opponent", games:Array(maxGames).fill(null), photo:null }]);
      const removeOpponent = (id) => setOpponents(p => p.filter(o => o.id !== id));
      const renameOpponent = (id, name) => setOpponents(p => p.map(o => o.id===id ? {...o, name} : o));
      const setResult = (id, i, val) => setOpponents(p => p.map(o => {
        if (o.id !== id) return o; const g = [...o.games]; g[i] = val; return {...o, games:g};
      }));
      const cycleResult = (cur) => cur===null ? "W" : cur==="W" ? "L" : null;
      const clearResults = (id) => setOpponents(p => p.map(o => o.id===id ? {...o, games:Array(maxGames).fill(null)} : o));
      const quickFill = (id, v) => setOpponents(p => p.map(o => o.id===id ? {...o, games:o.games.map(()=>v)} : o));

      // Photos
      const setPhotoURL = (id) => {
        const url = prompt("Paste public image URL:");
        if (!url) return;
        setOpponents(p => p.map(o => o.id===id ? {...o, photo:{type:"url", src:url}} : o));
      };
      const uploadPhotoFile = (id, file) => {
        if (!file) return;
        const rd = new FileReader();
        rd.onload = () => setOpponents(p => p.map(o => o.id===id ? {...o, photo:{type:"data", src:rd.result}} : o));
        rd.readAsDataURL(file);
      };
      const clearPhoto = (id) => setOpponents(p => p.map(o => o.id===id ? {...o, photo:null} : o));

      // Stats
      const overall = useMemo(()=>{
        const t = opponents.reduce((a,o)=>({
          wins: a.wins + o.games.filter(x=>x==="W").length,
          losses: a.losses + o.games.filter(x=>x==="L").length
        }), {wins:0,losses:0});
        const played = t.wins + t.losses;
        return { ...t, played, pct: played ? (t.wins/played)*100 : 0 };
      }, [opponents]);

      const league = useMemo(()=>{
        const rows = opponents.map(o=>{
          const wins = o.games.filter(x=>x==="W").length;
          const losses = o.games.filter(x=>x==="L").length;
          const played = wins + losses;
          const pct = played ? (wins/played)*100 : 0;
          return { id:o.id, name:o.name||"Opponent", wins, losses, played, pct, photo:o.photo };
        });
        rows.sort((a,b)=> b.pct - a.pct || b.played - a.played || a.name.localeCompare(b.name));
        return rows;
      }, [opponents]);

      const Tab = ({ id, children }) => (
        <button onClick={()=>setView(id)}
          className={clsx("px-3 py-2 rounded-2xl border shadow-sm text-sm",
                          view===id ? "bg-black text-white" : "bg-white")}>
          {children}
        </button>
      );

      return (
        <div className="min-h-screen text-gray-900 p-6">
          <div className="max-w-6xl mx-auto">
            <header className="mb-6 flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between">
              <div>
                <h1 className="text-2xl font-bold">Office Pool Tracker</h1>
                <p className="text-sm text-gray-600">Enter your phrase → auto-load from Google Drive (optional). Data stays encrypted.</p>
              </div>
              <div className="flex flex-wrap gap-2 items-end">
                <Tab id="tracker">Tracker</Tab>
                <Tab id="league">League</Tab>
                <Tab id="settings">Settings</Tab>
                <button onClick={relock} className="px-3 py-2 rounded-2xl border shadow-sm text-sm">Lock</button>
              </div>
            </header>

            {view==="tracker" && (
              <>
                <section className="mb-6">
                  <div className="grid grid-cols-1 sm:grid-cols-4 gap-4">
                    <div className="p-4 rounded-2xl bg-white shadow">
                      <div className="text-xs text-gray-500">Your Name</div>
                      <input value={meName} onChange={e=>setMeName(e.target.value)}
                             className="mt-1 w-full px-3 py-2 rounded-xl border bg-white shadow-sm focus:outline-none" />
                    </div>
                    <div className="p-4 rounded-2xl bg-white shadow">
                      <div className="text-xs text-gray-500">Games per Opponent</div>
                      <input type="number" min={1} max={100} value={maxGames}
                             onChange={e=>{ const n = Math.max(1, Math.min(100, Number(e.target.value)||MAX_GAMES_DEFAULT)); setMaxGames(n);
                               setOpponents(prev=>prev.map(o=>{ const g=[...o.games]; if(g.length>n) g.length=n; if(g.length<n) g.push(...Array(n-g.length).fill(null)); return {...o, games:g}; })); }}
                             className="mt-1 w-full px-3 py-2 rounded-xl border bg-white shadow-sm focus:outline-none" />
                    </div>
                    <div className="p-4 rounded-2xl bg-white shadow">
                      <div className="text-xs text-gray-500">Overall Record</div>
                      <div className="text-2xl font-semibold">{overall.wins} - {overall.losses}</div>
                    </div>
                    <div className="p-4 rounded-2xl bg-white shadow">
                      <div className="text-xs text-gray-500">Win Rate</div>
                      <div className="text-2xl font-semibold">{overall.played ? overall.pct.toFixed(1) : "0.0"}%</div>
                    </div>
                  </div>
                </section>

                <div className="mb-4 flex gap-2">
                  <button onClick={addOpponent} className="px-4 py-2 rounded-2xl bg-black text-white shadow hover:opacity-90">+ Add Opponent</button>
                </div>

                <ul className="space-y-4">
                  {opponents.map((o, idx) => {
                    const wins = o.games.filter(x => x === "W").length;
                    const losses = o.games.filter(x => x === "L").length;
                    const played = wins + losses;
                    const pct = played ? ((wins / played) * 100).toFixed(1) : "0.0";

                    return (
                      <li key={o.id} className="bg-white rounded-2xl shadow p-4">
                        <div className="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                          <div className="flex items-center gap-3">
                            <div className="w-12 h-12 rounded-full bg-gray-100 overflow-hidden flex items-center justify-center">
                              {o.photo ? (
                                <img src={o.photo.src} alt="" className="w-full h-full object-cover"/>
                              ) : (
                                <span className="text-sm text-gray-500">{(o.name||"Opp")[0]}</span>
                              )}
                            </div>
                            <input
                              value={o.name}
                              onChange={(e)=>renameOpponent(o.id, e.target.value)}
                              className="px-3 py-2 rounded-xl border bg-white shadow-sm focus:outline-none font-medium"
                            />
                          </div>
                          <div className="flex flex-wrap items-center gap-2">
                            <span className="text-sm text-gray-600">
                              {meName} vs <span className="font-medium">{o.name || "Opponent"}</span> — {wins}-{losses} • {pct}%
                            </span>
                            <div className="flex gap-2">
                              <button onClick={()=>quickFill(o.id,"W")} className="px-3 py-1 rounded-xl border shadow-sm">Fill W</button>
                              <button onClick={()=>quickFill(o.id,"L")} className="px-3 py-1 rounded-xl border shadow-sm">Fill L</button>
                              <button onClick={()=>clearResults(o.id)} className="px-3 py-1 rounded-xl border shadow-sm">Clear</button>
                              <button onClick={()=>removeOpponent(o.id)} className="px-3 py-1 rounded-xl border shadow-sm text-red-600">Remove</button>
                            </div>
                            <div className="flex gap-2 ml-2">
                              <label className="px-3 py-1 rounded-xl border shadow-sm cursor-pointer">
                                Upload Photo
                                <input type="file" accept="image/*" className="hidden" onChange={(e)=>uploadPhotoFile(o.id, e.target.files[0])}/>
                              </label>
                              <button onClick={()=>setPhotoURL(o.id)} className="px-3 py-1 rounded-xl border shadow-sm">Photo URL</button>
                              {o.photo && <button onClick={()=>clearPhoto(o.id)} className="px-3 py-1 rounded-xl border shadow-sm">Clear Photo</button>}
                            </div>
                          </div>
                        </div>

                        <div className="mt-4 flex flex-wrap gap-2">
                          {o.games.map((val, i) => (
                            <button
                              key={i}
                              onClick={()=>setResult(o.id, i, (val===null ? "W" : val==="W" ? "L" : null))}
                              className={clsx(
                                "w-10 h-10 rounded-xl border shadow-sm text-sm font-semibold",
                                val==="W" && "bg-green-100 border-green-300",
                                val==="L" && "bg-red-100 border-red-300"
                              )}
                              title={`Game ${i+1}: ${val ?? "blank"}`}
                            >
                              {val ?? i+1}
                            </button>
                          ))}
                        </div>
                      </li>
                    );
                  })}
                </ul>
              </>
            )}

            {view==="league" && (
              <section className="bg-white rounded-2xl shadow p-4">
                <div className="flex items-center justify-between mb-3">
                  <h2 className="text-lg font-semibold">League Table</h2>
                  <div className="text-sm text-gray-500">Ranked by win % (then games played)</div>
                </div>
                <div className="overflow-x-auto">
                  <table className="min-w-full text-sm">
                    <thead className="text-left text-gray-600">
                      <tr>
                        <th className="py-2 pr-4">#</th>
                        <th className="py-2 pr-4">Opponent</th>
                        <th className="py-2 pr-4">Played</th>
                        <th className="py-2 pr-4">Wins</th>
                        <th className="py-2 pr-4">Losses</th>
                        <th className="py-2 pr-4">Win %</th>
                      </tr>
                    </thead>
                    <tbody>
                      {league.map((r,i)=>(
                        <tr key={r.id} className="border-t">
                          <td className="py-2 pr-4">{i+1}</td>
                          <td className="py-2 pr-4">
                            <div className="flex items-center gap-2">
                              <div className="w-8 h-8 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center">
                                {r.photo ? <img src={r.photo.src} alt="" className="w-full h-full object-cover"/> : <span className="text-xs text-gray-500">{(r.name||"O")[0]}</span>}
                              </div>
                              <span className="font-medium">{r.name}</span>
                            </div>
                          </td>
                          <td className="py-2 pr-4">{r.played}</td>
                          <td className="py-2 pr-4">{r.wins}</td>
                          <td className="py-2 pr-4">{r.losses}</td>
                          <td className="py-2 pr-4">{r.played ? r.pct.toFixed(1) : "0.0"}%</td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </section>
            )}

            {view==="settings" && (
              <section className="bg-white rounded-2xl shadow p-4 space-y-6">
                <div>
                  <h2 className="text-lg font-semibold mb-2">Google Drive (Apps Script) Sync</h2>
                  <p className="text-sm text-gray-600 mb-2">Paste your Web App URL from Apps Script. Auto-load on unlock is ON by default.</p>
                  <input
                    placeholder="Apps Script Web App URL"
                    className="w-full px-3 py-2 rounded-xl border bg-white shadow-sm"
                    value={gasUrl}
                    onChange={(e)=>setGasUrl(e.target.value)}
                  />
                  <div className="mt-3 flex flex-wrap gap-4 items-center">
                    <label className="inline-flex items-center gap-2 text-sm">
                      <input type="checkbox" checked={autoLoad} onChange={e=>setAutoLoad(e.target.checked)} />
                      Auto-load on unlock
                    </label>
                    <label className="inline-flex items-center gap-2 text-sm">
                      <input type="checkbox" checked={autoSave} onChange={e=>setAutoSave(e.target.checked)} />
                      Auto-save changes
                    </label>
                    <button onClick={loadFromDrive} className="px-4 py-2 rounded-2xl border shadow-sm">Load now</button>
                    <button onClick={saveToDrive} className="px-4 py-2 rounded-2xl bg-black text-white shadow">Save now</button>
                  </div>
                </div>

                <div>
                  <h2 className="text-lg font-semibold mb-2">Export / Import (manual backup)</h2>
                  <div className="flex flex-wrap gap-2">
                    <button
                      className="px-4 py-2 rounded-2xl border shadow-sm"
                      onClick={()=>{
                        const data = { opponents, maxGames, meName };
                        const blob = new Blob([JSON.stringify(data,null,2)], {type:"application/json"});
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement("a"); a.href=url; a.download="pool-tracker-data.json"; a.click();
                        setTimeout(()=>URL.revokeObjectURL(url), 1000);
                      }}
                    >Download JSON</button>
                    <label className="px-4 py-2 rounded-2xl border shadow-sm cursor-pointer">
                      Import JSON
                      <input type="file" accept="application/json" className="hidden" onChange={(e)=>{
                        const f = e.target.files && e.target.files[0]; if(!f) return;
                        const rd = new FileReader();
                        rd.onload = ()=> {
                          try {
                            const d = JSON.parse(rd.result);
                            if (!Array.isArray(d.opponents)) throw new Error("Invalid file");
                            setOpponents(d.opponents.map(o=>({...o, photo:o.photo??null})));
                            setMaxGames(d.maxGames||MAX_GAMES_DEFAULT);
                            setMeName(d.meName||"Me");
                            alert("Import complete.");
                          } catch (err) { alert("Import failed: "+err.message); }
                        };
                        rd.readAsText(f);
                      }}/></label>
                  </div>
                </div>
              </section>
            )}

            <footer className="mt-10 text-xs text-gray-500 text-center">
              <p>Tip: Use the same phrase on any device. Set your Apps Script Web App URL in Settings for auto-load.</p>
            </footer>
          </div>
        </div>
      );
    }

    // Mount
    ReactDOM.createRoot(document.getElementById("root")).render(<Shell />);
  </script>
</body>
</html>
